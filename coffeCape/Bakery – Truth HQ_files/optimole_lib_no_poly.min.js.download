!function(){"use strict";class e{constructor(e){let t={root:null,rootMargin:"150px 0px 500px",threshold:this.buildThresholdList(),classTarget:this};this.observer=new IntersectionObserver(e,t)}addToObserver(e){this.observer.observe(e)}removeFromObserver(e){this.observer.unobserve(e)}buildThresholdList(){let e=[];for(let t=1;t<=6;t++){let a=t/6;e.push(a)}return e}}function t(e){let t=e.clientWidth,a=e.attributes.width?e.attributes.width.value:"auto",i=e.attributes.height?e.attributes.height.value:"auto",r="auto"===a||"auto"===i||"100%"===a||"100%"===i?e.clientHeight:parseInt(i/a*t);return t=parseInt(t),r=parseInt(r),isNaN(r)&&(r="auto"),{width:t,height:r}}function a(e,t){return Object.keys(t).forEach((function(a){e[a]=t[a]})),e}let i=new class{constructor(){this.serviceDomain=".i.optimole.com",this.serviceData={key:"undefined",quality:"auto",network_optimizations:!1,backgroundReplaceClasses:[],backgroundLazySelectors:"",watchClasses:[],lazyloadOnly:"",scalingDisabled:!1,ignoreDpr:!0,customDomain:!1},"undefined"!=typeof optimoleData&&optimoleData===Object(optimoleData)&&(this.serviceData=a(this.serviceData,optimoleData)),this.aTag=null}_cdnKey(){return this.serviceData.key.toLowerCase()}_sortByKey(e){const t={};return Object.keys(e).sort().forEach(a=>{t[a]=e[a]}),t}getAbsoluteUrl(e){return null===this.aTag&&(this.aTag=document.createElement("a")),this.aTag.href=e,this.aTag.href}getImageCDNUrl(e,t){const a=void 0!==this.serviceData.customDomain&&!1!==this.serviceData.customDomain;if(e.includes(this.serviceDomain)||!0===a&&e.includes(this.serviceData.customDomain))return e;if(("undefined"===this._cdnKey()||""===this._cdnKey())&&!1===a)return e;e=this.getAbsoluteUrl(e);let i=`https://${this._cdnKey()}${this.serviceDomain}`;!0===a&&(i="https://"+this.serviceData.customDomain);let r=this.serviceData.quality,s=e.split("://"),o=s[0],l=s[1];"auto"!==t.width&&(t.width=Math.round(t.width)),"auto"!==t.height&&(t.height=Math.round(t.height)),"eco"===t.quality&&(r=t.quality);let n={path:encodeURIComponent(l.replace(/\/$/,"")),scheme:o+":/",width:"w:"+t.width.toString(),height:"h:"+t.height.toString(),quality:"q:"+r.toString()};n=this._sortByKey(n);let c=[i,n.width,n.height,n.quality,n.scheme,l];return!1===this.serviceData.ignoreDpr&&window.devicePixelRatio>1&&c.splice(4,0,"dpr:"+window.devicePixelRatio.toFixed(1).toString()),c.join("/")}updateImages(e){let t=document.getElementsByTagName("img");for(let a=0;a<t.length;a++)t[a].dataset.optLazyLoaded="false",!1===e.replacerService.serviceData.ignoreDpr&&void 0!==t[a].dataset.optSrc&&(void 0!==t[a].style.maxWidth&&""!==t[a].style.maxWidth||"undefined"!==getComputedStyle(t[a]).maxWidth&&""!==getComputedStyle(t[a]).maxWidth||(t[a].style.maxWidth="100%")),e.lazyLoadImage({target:t[a]})}requiresBetterQuality(e){return void 0===e.dataset.optOptimizedWidth||void 0===e.dataset.optOptimizedHeight||(parseInt(e.dataset.optOptimizedWidth)!==parseInt(e.clientWidth)||parseInt(e.dataset.optOptimizedHeight)!==parseInt(e.clientHeight))}transformURL(e,t){let[a,i]=e.split("://");if("http"!==a&&"https"!==a)return e;if(""===i||"undefined"===i)return e;const r=new RegExp("(?:(w|h|q):)?(([0-9.]+|mauto|auto|eco))","gm");let s,o=[],l="",n=navigator.connection||navigator.mozConnection||navigator.webkitConnection;for(n&&(l=n.effectiveType);null!==(s=r.exec(e));){s.index===r.lastIndex&&r.lastIndex++;let e=["w","h","q"];if(void 0!==s[1]&&-1!==e.indexOf(s[1])){let e=s[2];switch(s[1]){case"w":e=this.sizeSafe(this.sizeForConnection(l,t.width));break;case"h":e=this.sizeSafe(this.sizeForConnection(l,t.height));break;case"q":let a=s[2];void 0!==t.quality&&t.quality!==a&&(a=t.quality),e=this.qualityForConnection(l,a),!1===this.serviceData.ignoreDpr&&window.devicePixelRatio>1&&(e+="/dpr:"+window.devicePixelRatio.toFixed(1).toString())}let a=s[1]+":"+s[2],i=s[1]+":"+e;o.push({find:a.toString(),replace:i.toString()})}}let c=e;if(0===o.length)return e;for(let e in o)void 0!==o[e].find&&void 0!==o[e].replace&&(c=c.replace(o[e].find.toString(),o[e].replace.toString()));return c}sizeSafe(e){return null===e||"undefined"===e||"0"===e||0===e||isNaN(e)?"auto":e}qualityForConnection(e,t){if(!0!==this.network_optimizations)return t;let a;switch(e){case"4g":case"3g":a=t;break;case"2g":case"slow-2g":a="45";break;default:a=t}return a}sizeForConnection(e,t){if(!0!==this.network_optimizations)return t;let a=window.devicePixelRatio;switch(e){case"3g":return Math.round(t/a);case"2g":case"slow-2g":return Math.round(t/a);case"4g":default:return t}}getCDNForImage(e,i){let r=t(e);return r=a(r,i),{url:this.transformURL(this.getImageCDNUrl(e.dataset.optSrc,r),r),size:r}}},r=new class{constructor(e=null){this.replacerService=e}onlyLazyload(e){return void 0!==this.replacerService.serviceData.scalingDisabled&&!0===this.replacerService.serviceData.scalingDisabled||""!==this.replacerService.serviceData.lazyloadOnly&&e.classList.contains(this.replacerService.serviceData.lazyloadOnly)}requiresBetterQuality(e){return null===this.replacerService||"undefined"===this.replacerService||this.replacerService.requiresBetterQuality(e)}getImageSrc(e,i={}){let r=t(e);return r=a(r,i),null!==this.replacerService&&"undefined"!==this.replacerService?this.onlyLazyload(e)?{url:e.dataset.optSrc,size:r}:this.replacerService.getCDNForImage(e,r):"undefined"!==i&&"undefined"!==i.quality&&"eco"===i.quality?{url:"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",size:r}:{url:e.dataset.optSrc,size:r}}prepareImage(e,t){let a=e.target;if((void 0===a.src||""===a.src)&&a.dataset.optSrc){let e={quality:"eco"},t=this.getImageSrc(a,e);a.src=t.url}t.addToObserver(a)}prepareEmbeddedVideo(e,t){let a=e.target;t.addToObserver(a)}skipLazyLoad(e){let t=e.target;if("IFRAME"===t.tagName&&t.dataset.optSrc)return t.src=t.dataset.optSrc,void(t.dataset.optLazyLoaded="true");if(t.dataset.optSrc){let e=this.getImageSrc(t);t.src=e.url,t.dataset.optLazyLoaded="true"}}lazyLoadImage(e){let t=e.target;if(void 0!==t.dataset.optSrc&&this.requiresBetterQuality(t)&&"true"!==t.dataset.optLazyLoaded){let e=this.getImageSrc(t),a=e.url,i=new Image;t.classList.add("optml_lazyload_img");let r=this;i.onload=async function(){this.complete&&(t.src=this.src,t.dataset.optLazyLoaded="true",null!==r.replacerService.serviceData&&!1===r.replacerService.serviceData.ignoreDpr&&window.devicePixelRatio>1&&(!r.onlyLazyload(t)&&"auto"!==e.size.width&&e.size.width>0&&(void 0!==t.style.maxWidth&&""!==t.style.maxWidth||"undefined"!==getComputedStyle(t).maxWidth&&""!==getComputedStyle(t).maxWidth||(t.style.maxWidth=e.size.width+"px")),!t.width&&!t.height&&!t.classList.contains(r.replacerService.serviceData.lazyloadOnly)&&"auto"!==e.size.width&&"auto"!==e.size.height&&e.size.width>0&&e.size.height>0&&(t.width=""+e.size.width,t.height=""+e.size.height)),t.dataset.optOptimizedWidth=""+e.size.width,t.dataset.optOptimizedHeight=""+e.size.height,t.classList.remove("optml_lazyload_img"))};let s=t.parentNode;if(s&&/^picture$/i.test(s.nodeName||""))for(let e of s.getElementsByTagName("source"))if(e.srcset===t.currentSrc)return void(i.src=t.currentSrc);i.src=a}else if(null!==this.replacerService&&void 0!==this.replacerService){if("true"!==t.dataset.optLazyLoaded&&this.replacerService.serviceData.watchClasses.length>0)for(let e=0;e<this.replacerService.serviceData.watchClasses.length;e++)if(t.classList.contains(this.replacerService.serviceData.watchClasses[e]))return void this.lazyLoadWatchClass(t);if(this.replacerService.serviceData.backgroundReplaceClasses.length>0)for(let e=0;e<this.replacerService.serviceData.backgroundReplaceClasses.length;e++)if(t.classList.contains(this.replacerService.serviceData.backgroundReplaceClasses[e]))return void this.lazyLoadImageBackground(t)}}lazyLoadVideo(e){let t=e.target;void 0!==t.dataset.optSrc&&"true"!==t.dataset.optLazyLoaded&&(e.target.src=e.target.dataset.optSrc,"VIDEO"===e.target.tagName?e.target.onloadstart=function(){e.target.dataset.optLazyLoaded="true"}:e.target.onload=function(){e.target.dataset.optLazyLoaded="true"})}lazyLoadWatchClass(e){let t={width:"auto",height:"auto",quality:"auto"},a=e.src,i=this.replacerService.transformURL(a,t),r=new Image;r.onload=async function(){this.complete&&(e.src=this.src,e.dataset.optLazyLoaded="true",e.dataset.optOptimizedWidth=""+t.width,e.dataset.optOptimizedHeight=""+t.height)},r.src=i}lazyLoadImageBackground(e){let a=t(e);if(a.quality="auto","undefined"!==this.replacerService.serviceData.quality&&(a.quality=this.replacerService.serviceData.quality),e.classList.contains("optml-bg-lazyloaded"))return;let i=e.style.backgroundImage.slice(4,-1).replace(/['"]/g,""),r=this.replacerService.transformURL(i,a);-1===i.indexOf("/q:eco/")&&(r=this.replacerService.transformURL(this.replacerService.getImageCDNUrl(i,a),a));let s=new Image;e.classList.add("optml-bg-lazyloaded"),s.onload=async function(){this.complete&&(e.style.backgroundImage=`url(${this.src})`)},s.src=r}}(i),s=new e((function(e,t){e.forEach((function(e){if(e.isIntersecting){if(function(){try{return window.self!==window.top}catch(e){return!0}}())return r.skipLazyLoad(e),void t.unobserve(e.target);if("IFRAME"===e.target.tagName||"VIDEO"===e.target.tagName)return r.lazyLoadVideo(e),void t.unobserve(e.target);r.lazyLoadImage(e),t.unobserve(e.target)}}))})),o=new e((function(e,t){e.forEach((function(e){e.isIntersecting&&(e.target.classList.contains("optml-bg-lazyloaded")||(e.target.classList.add("optml-bg-lazyloaded"),t.unobserve(e.target)))}))})),l=function(e){if(null!==r.replacerService&&"undefined"!==r.replacerService&&r.replacerService.serviceData.backgroundReplaceClasses.length>0){if(void 0===e.classList||0===e.classList.length)return!1;for(let t=0;t<r.replacerService.serviceData.backgroundReplaceClasses.length;t++)if(e.classList.contains(r.replacerService.serviceData.backgroundReplaceClasses[t]))return!0}return!1},n=function(e){(1===e.nodeType&&"IMG"===e.tagName||l(e))&&r.prepareImage({target:e},s);let t=e.childNodes;for(let e=0;e<t.length;e++)1===t[e].nodeType&&n(t[e])};new class{constructor(e){this.observer=new MutationObserver(e)}init(){let e=document.getElementsByTagName("html")[0];this.addToObserver(e)}addToObserver(e){this.observer.observe(e,{attributes:!0,childList:!0,subtree:!0})}}((function(e,t){for(let t of e){if("childList"===t.type)for(let e=0;e<t.addedNodes.length;e++){let a=t.addedNodes[e];n(a)}if("attributes"===t.type){let e=t.target.getElementsByTagName("img");for(let t=0;t<e.length;t++)r.prepareImage({target:e[t]},s);let a=t.target.querySelectorAll("iframe[data-opt-src], video[data-opt-src]");for(let e=0;e<a.length;e++)r.prepareEmbeddedVideo({target:a[e]},s)}}if(null!==r.replacerService&&"undefined"!==r.replacerService&&""!==r.replacerService.serviceData.backgroundLazySelectors){const e=document.querySelectorAll(r.replacerService.serviceData.backgroundLazySelectors);for(let t=0;t<e.length;t++)o.addToObserver(e[t])}})).init(),"loading"!==document.readyState?g():document.addEventListener("DOMContentLoaded",g);let c=document.getElementsByTagName("img");for(let e=0;e<c.length;e++)r.prepareImage({target:c[e]},s);let d=document.getElementsByTagName("div");for(let e=0;e<d.length;e++)l(d[e])&&r.prepareImage({target:d[e]},s);let u=document.querySelectorAll("iframe[data-opt-src], video[data-opt-src]");for(let e=0;e<u.length;e++)r.prepareEmbeddedVideo({target:u[e]},s);let h=window.innerWidth;function g(){if(null!==r.replacerService&&"undefined"!==r.replacerService&&""!==r.replacerService.serviceData.backgroundLazySelectors){const e=document.querySelectorAll(r.replacerService.serviceData.backgroundLazySelectors);for(let t=0;t<e.length;t++)o.addToObserver(e[t])}let e;window.addEventListener("resize",(function(){clearTimeout(e),e=setTimeout((function(){let e=new Event("resize-end");window.dispatchEvent(e)}),500)}))}window.addEventListener("resize-end",(function(){let e=window.innerWidth;(1.15*h<=e||.85*h>=e)&&i.updateImages(r),h=e}))}();
